{% include "_nav.html" %}
<div class="container">
  <div class="card">
    <h2 style="margin-top:0;">订单列表</h2>
    <form method="get" class="row">
      <input class="input" name="q" value="{{q or ''}}" placeholder="按订单号/追踪号搜索">
      <button class="btn" type="submit">查询</button>
      <a class="btn" style="margin-left:12px" href="/admin/orders/export-xlsx">导出Excel（追踪号+订单号）</a>
    </form>

    <table class="table">
      <thead><tr><th>#</th><th>订单号</th><th>追踪号</th><th>操作</th></tr></thead>
      <tbody>
      {% for r in rows %}
      <tr>
        <td>{{ loop.index + (page-1)*100 }}</td>
        <td>{{ r.get('order_id') or r.get('customer_order') or '' }}</td>
        <td>{{ r.get('tracking_no') or '' }}</td>
        <td>
          <form method="post" action="/admin/orders/unbind" style="display:inline" onsubmit="return confirm('确认解绑？')">
            <input type="hidden" name="tracking_no" value="{{ r.get('tracking_no') or '' }}">
            <button class="btn">解绑</button>
          </form>
        </td>
      </tr>
      {% endfor %}
      </tbody>
    </table>

    <div class="pager">
      {% for p in range(1, pages+1) %}
        {% if p==page %}<b>{{p}}</b>{% else %}
        <a href="?page={{p}}&q={{q or ''}}">{{p}}</a>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</div>
