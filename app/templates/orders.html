{% include "_nav.html" %}
{% block content %}
<h2>订单列表</h2>
<form method="get" class="row">
  <input name="q" value="{{q or ''}}" placeholder="按订单搜索">
  <select name="bind" title="绑定状态">
    <option value="" {{ 'selected' if not bind }}>全部</option>
    <option value="bound" {{ 'selected' if bind=='bound' }}>已绑定追踪号</option>
    <option value="unbound" {{ 'selected' if bind=='unbound' }}>未绑定</option>
  </select>
  <button type="submit">查询</button>
  <a class="primary" style="margin-left:12px" href="/admin/orders/export-xlsx?q={{q or ''}}&bind={{bind or ''}}">导出Excel（追踪号+订单号）</a>
</form>

<form method="post" action="/admin/orders/batch_delete_all" class="row" onsubmit="return confirm('确定批量删除？若未设置搜索条件将删除全部订单。')">
  <input type="hidden" name="q" value="{{q or ''}}">
  <button type="submit" class="danger">批量删除</button>
</form>

<table class="table">
  <thead>
    <tr><th>#</th><th>订单</th><th>运单</th><th>更新时间</th></tr>
  </thead>
  <tbody>
    {% for r in rows %}
      <tr>
        <td>{{loop.index + (page-1)*page_size}}</td>
        <td>{{r.order_id}}</td>
        <td>{{r.tracking_no}}</td>
        <td>{{r.updated_at}}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<div class="pager">
  {% for p in range(1, pages+1) %}
    {% if p==page %}
      <b>{{p}}</b>
    {% else %}
      <a href="?page={{p}}&q={{q or ''}}&bind={{bind or ''}}">{{p}}</a>
    {% endif %}
  {% endfor %}
</div>
{% endblock %}
